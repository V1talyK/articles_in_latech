\documentclass{article}

\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage[tbtags]{amsmath}
\usepackage{amscd}
\usepackage{amsthm}			% Продвинутая математика
\usepackage{mathtext}
\usepackage{cmap}
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}			% cp1251
\usepackage[english, russian]{babel}
%\usepackage{literat}
\usepackage{pifont}
\usepackage{bm}
\usepackage{array}			% Ширина столбиков в массиве
\usepackage{dcolumn}
\usepackage{hhline}
\usepackage{multirow}
\usepackage{graphicx}
\usepackage{rotating}
\usepackage{calc}
\usepackage{tabularx}
\usepackage{afterpage}
\usepackage{ifthen}
\usepackage{caption2}
\usepackage{substr}
\usepackage[mathscr]{eucal}  %% My addition
\usepackage{mathrsfs}        %% My addition
\usepackage{hypbmsec}        %% My addition
\usepackage{latexsym}        %% My addition
\usepackage{xypic}           %% My addition
\RequirePackage{soul}
\RequirePackage{verbatim}    %% My addition
\RequirePackage{chapterbib}
\RequirePackage{enumerate}

\usepackage[shortcuts]{extdash}
\usepackage{ragged2e}
\usepackage{etoolbox}
\usepackage{lipsum}

%\usepackage{flafter}
\usepackage[section,above,below]{placeins}

\usepackage{indentfirst}
\usepackage[a4paper, top=20mm, left=30mm, right=20mm, bottom=25mm]{geometry}

\title{Исследование влияния объёма исходных данных при решении задачи идентификация поля проницаемости для нефтяного месторождения}
\author{V.P. Kosyakov}


\begin{document}
	\maketitle
	\textbf{Abstract}. При моделировании разработки нефтяного месторождения одним из важнейших шагов является решение обратной задачи, решение которой, как правило, заключается в подборе параметров модели для наилучшей настройки на историю разработки. Однако целью моделирования является не только повторение показателей разработки на историческом периоде, но и получение достоверного прогноза поведения моделируемого объекта в будущем. Поэтому с точки зрения долгосрочных прогнозных характеристик модели необходимо выполнение не только параметрической, но и структурной идентификации модели.
В данной работе на примере решения задачи структурно-параметрической идентификации модели водоносного контура (аквифера) для моделирования разработки нефтяного месторождения проведено исследование прогнозных характеристик. Показано, что в результате выполнения структурно-параметрической идентификации модели ее прогнозные свойства могут быть существенно улучшены по сравнению со случаем обычной параметрической идентификации. 

\textbf{Keywords}: обратная задача, параметрическая идентификация, моделирование, фильтрация

\section{INTRODUCTION}
	В настоящее время широкое распространение получило создание цифровых (численных) двойников всевозможных объектов и физических процессов, в основе которых, как правило, лежат математические модели. Для успешного использования подобных моделей на практике необходимым условием является воспроизведение фактического поведения исследуемого объекта. Для удовлетворения этого требования численные модели проходят процедуру настройки (адаптации), которая представляет собой решение обратной задачи с целью подбора некоторых параметров модели, начальных и/или граничных условий, которые не известны с достаточной точностью. 
	
	Применительно к задачам фильтрации, подземной гидродинамики, разработки нефтяных месторождений актуальной задачей является задача восстановления поля проницаемости. Ввиду малого объёма знаний о истинном поле проницаемости породы, данные о котором непосредственно могут быть получены лишь при бурении скважин, значение проницаемости в меж скважинном пространстве является оценочным. Значение проницаемости является одним из  важных параметров, характеризующих потенциал и процесс разработки месторождения. Следовательно, задача восстановления или уточнения поля проницаемости является важной задачей. При использовании гидродинамической модели и известных фактических значениях основных показателей разработки на историческом периоде (отборы жидкости, нефти, закачка воды, пластовые и забойные давления и т.д.), становится возможным получение решения обратной задачи. Находится такое поле проницаемости, при использовании которого расчётные значения показателей удовлетворяют с достаточной точностью фактическим данным.
	
	Процедура решения обратной задачи является обязательным шагом при использовании гидродинамической модели при моделировании фильтрационных процессов. Следовательно на качество получаемого решения помимо точности самой модели оказывает влияние качество и объём данных (показателей разработки) используемых при настройке модели. Объём исходных данных должен соответствовать сложности используемой математической модели, а также ожиданиям от её прогнозных характеристик. Так при наличии только значений давления и отборов жидкости хватит однофазной задачи, если имеется ещё и значения добычи нефти, то можно решить и двухфазку и получить адекватный прогноз по ней.
	
	В настоящей работе представлено исследование зависимости адаптационных характеристик модели от объёма и разнообразия исходных данных. На примере задачи параметрической идентификации фильтрационной модели для нефтяного месторождения в однофазной и двухвазной постановках, показана важность использования всего объёма исходных данных. В качестве прогнозируемого параметры выступает пластовое давление, характеризующее “энергетический” потенциал залежи и обводнёность добываемой продукции в двухфазной постановке.

\section{Mathematical Models}
Для решения поставленной задачи в качестве фильтрационной модели использовалась двумерная математическая модель фильтрации несжимаемой "цветной" жидкости \cite{bas}. Использование модели цветной жидкости предполагает: одинаковую вязкость жидкостей равную $\mu$, прямо пропорциональную зависимость относительной фазовой проницаемости от насыщенности соответствующей фазой, отсутствие влияния насыщенности на давление, капиллярные силы не учитываются, давление фаз принимается равным. Таким образом уравнения фильтрации можно записать следующим образом: 
\begin{equation} \label{fil}
\triangledown\frac{k}{\mu}\triangledown P = \delta_{l}(x,y),
\end{equation}
\begin{equation} \label{fil2}
\frac{\phi\partial S_w}{\partial t} = \triangledown\frac{kk_{rw}}{\mu}\triangledown P +\delta_w(x,y),
\end{equation}
\begin{equation} \label{bc}
\delta_{i}(x,y)  = \left\{\begin{array}{crl}
0, \;при\;(x,y) \notin\ \Gamma_{in}\cup\Gamma_{out}\\
q_{i\:k}, \;при\;(x,y) \in \Gamma_{in}\\
q_{i\:aq}, \;при\;(x,y) \in \Gamma_{out}
\end{array}\right.,
\end{equation}
\begin{equation*}
	i = l,w.
\end{equation*}
Замыкающие соотношения:
\begin{equation*}
	S_w + S_o = 1,
\end{equation*}
\begin{equation} \label{kr}
	k_w = S_w, \quad k_o = 1 - S_w,
\end{equation}
\begin{equation*}
	P = P_0,\quad S_w = S_{w0}\mbox{,\quad при $t=0$},
\end{equation*}
где $k$ - проницаемость, $P$ - пластовое давление, $\phi$ - пористость, $S$ - насыщенность, нижний индекс $i$ обозначает $l$ - жидкость (вода и нефть), $w$ - вода, или  $k_{r}$ - относительная фазовая проницаемость, $q_k$ - расход флюида в $k$-той скважине, $\Gamma_{in}$ - множество координат источников/стоков (скважин), $\Gamma_{out}$ - внешняя граница, $P_0$ - пластовое давление и $S_{w0}$ - водонасыщенность в начальный момент времени $t=0$, $q_{aq}$ - удельный расход флюида через внешнюю границу, который находится по формуле:

\begin{equation} \label{qaq}
q_{i\:aq} = \lambda \frac{kk_{ri}}{\mu}(P|_{\Gamma_{out}}-P_c),
\end{equation}
где $P_{c}$ - на контуре питания ($P_c = P_0$), $\lambda$ - коэффициент продуктивности аквифера. Предполагается, что водонасыщенность контура питания $S_{c\:w} = 1$.
Решение обратной задачи заключается в поиске поля проницаемости $k = k(x,y)$ при котором расчётные значения пластового давления и расхода воды на скважинах будут удовлетворительно совпадать с исходными значениями соответствующих параметров. Обратная задача решается в оптимизационной постановке, которая заключается в минимизации целевой функции $J$. Целевую функцию можно записать в виде суммы слагаемых, каждое из которых является произведением функции характеризующей отклонение расчётных значений от контрольных и весового коэффициента для соответствующего типа переменной. В качестве меры отклонения выбрана средняя квадратичная ошибка "Mean Squared Error" (MSE). 
\begin{equation} \label{mse}
	J=w_p\frac{1}{N}\sum_{i=1}^N{\left(p_c^i-p_f^i\right)^2}+w_{q_w}\frac{1}{M}\sum_{i=1}^M{\left(q_{w\:c}^i-q_{w\:f}^i\right)^2}
\end{equation}
где $p_c^i$ -расчетное значение пластового давления, $p_f^i$ - фактическое значение, $i$ - номер замера, $N$ - количество замеров пластового давления, $q_{w\:c}^i$ и $q_{w\:f}^i$ - расчетное и фактическое значение расхода воды на скважинах соответственно, нижний индекс $f$ означает фактические значения (fact), а $c$ - расчётные (calculated), $M$ - количество замеров расхода воды на скважине, $w_p$ и $w_{q_w}$- весовые коэффициенты учитывающие степень влияния различных параметров (размерность, качество данных и т.д.). Аргументами слагаемого целевой функции отвечающего за давление выступают фактические (замеренные) и расчётные значения пластового давления в точках расположения скважин в заданные моменты времени.  
 Расчётные значения в свою очередь зависят от параметров модели $u$. Решение находится при использовании градиентного оптимизационного алгоритма и заключается в определении набора параметров модели соответствующих минимуму $J$ и удовлетворяющих ограничениям в виде неравенств:
\begin{equation*}
u_{min}\leq\ \boldsymbol{u}\leq u_{max},
\end{equation*}
$u_{min}$ и $u_{max}$ - минимальный и максимальные значения для каждого параметра.

При использовании градиентного метода оптимизации, необходимо найти компоненты градиента целевой функции, которые можно записать в следующем виде:
\begin{equation}
\frac{\partial J}{\partial u_k} = 2w_p\frac{1}{N}\sum_{i=1}^N ({p_c^i-p_f^i})\frac{\partial p_c^i}{\partial u_k}+2w_{q_w}\frac{1}{M}\sum_{i=1}^M{\left(q_{w\:c}^i-q_{w\:f}^i\right)}\frac{\partial q_{w\:c}^i}{\partial u_k}.
\end{equation}
Для решения оптимизационной задачи необходимо чтобы каждая компонента градиента целевой функции стремилась к 0, что можно записать как:
\begin{equation} \label{rp}
	 \frac{\partial J}{\partial u_k} \rightarrow 0
\end{equation}
Решение обратной задачи (\ref{rp}) находится численно итерационным методом. На каждой итерации численно решается прямая задача (\ref{fil}-\ref{bc}) и осуществляется расчёт производных целевой функции по настраиваемым параметрам модели \cite{opt}. Численное решение находилось методом контрольного объёма  для двумерной прямоугольной разностной сетки при использовании IMPES метода.

Для расчёта слагаемого компоненты градиента целевого функционала, отвечающего за отклонение расходов фаз (воды) необходимо его преобразовать к виду, где множитель $\frac{\partial q_{w\:c}^i}{\partial u_k}$ будет выражен через производную пластового давления от параметра $u_k$. Так как расход воды выражается через расход жидкости и относительную фазовую проницаемость для модели цветных жидкостей как:
 \begin{equation*}
 	q_{w\:c}^i = k_{w}^i \: q_{w\:c}^i
 \end{equation*}

\begin{equation} \label{dq_du}
\frac{\partial q_{w\:c}^i}{\partial u_k} = k_{w}^i \frac{\partial q_{l\:c}^i}{\partial u_k} + q_{l\:c}^i \frac{\partial k_{w}^i}{\partial u_k} = q_{l\:c}^i \frac{\partial k_{w}^i}{\partial s_w^i} \frac{\partial s_w^i}{\partial p_c^i}\frac{\partial p_c^i}{\partial u_k},
\end{equation}
где $s_w^i$ - водонасыщенность в прискважинной области.
Для модели цветных жидкостей и при условии (\ref{bc}, \ref{kr}) первый множитель можно представить в виде:
\begin{equation}
\frac{\partial q_{w\:c}^i}{\partial s_w^i} = q_l^i\frac{\partial k_{w}^i}{\partial s_w^i} = q_l^i.
\end{equation}
Множители $\frac{\partial p_c^i}{\partial u_k}$ и $\frac{\partial s_w^i}{\partial p_с^i}$ находится численно при использовании уравнений (\ref{fil}) и (\ref{fil2}) соответственно.

Целевая функция, используемая при решении обратной задачи {\ref(mse)}, не всегда удобна при оценке точности модели. Для оценки качества настройки модели в качестве дополнительной метрики использовался показатель - средняя абсолютная ошибка в процентах "Mean Absolute Percentage Error" (MAPE). Для показателей "пластовое давление" и  "расход воды" эти метрики можно представить следующим образом.

\begin{equation} \label{mape_p}
 	J_{mape(p)}=\frac{1}{N}\sum_{i=1}^N{\left|\frac{p_c^i-p_f^i}{p_f^i}\right|},
\end{equation}
\begin{equation} \label{mape_qo}
 	J_{mape(q_w)}=\frac{1}{M}\sum_{i=1}^M{\left|\frac{q_{w\:c}^i-q_{w\:f}^i}{q_{w\:f}^i}\right|}.
\end{equation}
Данная метрика позволяет наглядно дать оценку качеству воспроизведения моделью фактических значений пластового давления и расхода воды на скважинах.
\section{Сalculation Results}
На примере решения обратной задачи поиска поля проницаемости для нефтяного месторождения было выполнено исследование зависимости качества адаптации от количества исходных данных. Для выполнения исследования необходим набор данных (размеры расчётной области, расположение скважин и показателей разработки по скважинам: расходы жидкости и давления), который был получен при помощи синтетической гидродинамической модели. Эти данные выступали в качестве "фактических" значений. Схема расположения скважин представлена на рисунке \ref{fig:map}, размеры указанны в метрах. 
\begin{figure}
	\center{\includegraphics[height=12pc]{fig1.png}}
    \caption{Схематическое представление расчётной области.}
	\label{fig:map}
\end{figure}

Месторождение разрабатывается при помощи 8 добывающих и 1 нагнетательной скважины. Период разработки составляет 30 лет, контур питания был “подключён” по периметру расчетной области. Для решения задачи параметрической идентификации период разработки был разбит на 2 интервала, интервал адаптации и интервал валидации, составляющие 20, 10 лет соответственно. Объём исходных данных, который будет использоваться при настройке модели на этапе адаптации составляет 63 значений давления и 1920 значений расхода воды, для интервала валидации этот объём составляет 37 и 960 значений соответственно. 

Задача адаптации решается для 11 вариантов наборов весовых коэффициентов $(w_p, w_{q_w})$ используемых в целевой функции {\ref{mse}}. Значения весовых коэффициентов в наборах задавалось таким образом чтобы выполнялось условие $w_p = 1 - w_{q_w}$, где $w_{q_w}$ изменялось от 0 до 1 с шагом 0,1. Таким образом, при значении одного из весовых коэффициентов равным 0, модель настраивается только на один из двух видов исходных данных. 
\begin{enumerate}
	\item Вариант 1 - используется только 100 значений пластового давления;
	\item Вариант 2 - используется только 2880 значений дебита нефти;
	\item Вариант 3 - используется 100 значений пластового давления и 2880 значений дебита нефти;
\end{enumerate}
Методология проведения исследования: задаётся поле проницаемости, задаются режимы работы скважин (расходы жидкостей), решается прямая задача, расчётные значения пластового давления и расхода нефти сохраняются и далее выступают в качестве фактических значений. Далее вносится возмущение в исходное поле проницаемости, которое выступает в качестве начального приближения при решении обратной задачи. Далее решается обратная задача с целью восстановить такое поле проницаемости что-бы максимально точно воспроизвести фактические значения пластового давления и расхода нефти на скважинах. В целевая функция может включать в себя разное кол-во фактических данных, предельные варианты описаны при описании вариантов.

На интервале валидации оцениваются прогнозные характеристики настроенной модели. 


На рисунке \ref{fig:din} представлена динамика среднего пластового давления для фактических данных (B - базовый вариант) и моделей водоносного горизонта (M1-M4 модели аквифера). На рисунке \ref{fig:hist} ввиде гистограммы показанны значения целевой функции (\ref{mape_p}) для интервалов адаптации (adp) и валидации (val), которая характеризует отличие вариантов M1-M4 от варианта B.
\begin{figure} 
    \begin{minipage}[h]{0.48\linewidth}
      \center{\includegraphics[height=0.60\linewidth]{fig2.png}}
      \caption{Значения пластового давления, используемые для оценки точности настройки модели для этапов адаптации и валидации.}
      \label{fig:din}
    \end{minipage} \hfill
    \begin{minipage}[h]{0.48\linewidth}
      \center{\includegraphics[height=0.60\linewidth]{fig2_2.png}}
      \caption{Значения суммарных расходов жидкости и воды, используемые для оценки точности настройки модели для этапов адаптации и валидации.}
      \label{fig:qlic}
    \end{minipage} 
\end{figure}

На рисунке \ref{fig:wp} представлены значения метрики MAPE для показателей давления, расхода воды на этапах адаптации и валидации в зависимости от 


\begin{figure}
	\center{\includegraphics[height=12pc]{fig3.png}}
	\caption{Значения метрики MAPE для 11 вариантов весовых коэффициентов для интервалов адаптации (adp) и валидации (val)}
	\label{fig:wp}
\end{figure}


Средняя обводнёность добываемой жидкости представлена на рисунке \ref{fig:wtс}. Пиктограммами на рисунке нанесены значения обводнённости на каждый месяц, линиями усреднённые значения для четырёх вариантов: исходный вариант и 3 варианта адаптации модели с весовым коэффициентом $w_p$ равными 0, 0.1 и 1. 
\begin{figure}
	\center{\includegraphics[height=12pc]{fig4.png}}
	\caption{Динамика обводнённости добываемой жидкости: фактические значения и для 3х вариантов адаптации модели.}
	\label{fig:wtс}
\end{figure}
Из рисунка видно, что вариант адаптации при учёте только пластового давления $(w_p=1)$ заметно отличается исходного варианта как на этапе адаптации, так и на интервале валидации. Вариант адаптации, учитывающий только расходы воды $(w_p=0)$, в меньшей степени отличается от исходного варианта, это объясняется тем, что расход фаз на скважинах зависит как 
непосредственно от пластового давления, так и от структуры фильтрационных потоков в межскважинном пространстве, которая в свою очередь зависит от пластового давления. Это также видно из уравнения \ref{dq_du}, где производная расхода воды по проницаемости зависит от производной давления по проницаемости. С точки зрения прогнозирования наилучшим является вариант адаптации, который комплексно учитывает давление и расход воды, пониженный весовой коэффициент $(w_p=1)$ объясняется тем, что зависимость от пластового давления, как было сказано ранее, входит в слагаемое целевой функции отвечающее за расход воды и косвенно учитывается. Тем не менее наличие слагаемого отвечающее за пластовое давление имеет значение при безводном периоде работы, когда фронт водонасыщенности ещё не дошёл до добывающих скважин. Таким образом использование в качестве целевой функции суммы позволяет более полно использовать всю имеющуюся информацию. В случае необходимости настройки параметров водоносного контура питания, модель была бы максимально чувствительна именно в начальные периоды разработки.

\section{CONCLUSIONS}

В результате исследования было показано, что точность решения обратной задачи зависит от выбора весовых коэффициентов, характеризующих степень влияния на настройку определённого вида данных. Использование комбинации исходных данных позволяет повысить степень регуляризации задачи, но точность как адаптации так и валидации зависит от пропорций выбранных весовых коэффициентов. Зависимость точности настройки на определённый показатель не является условно линейной от соответвующего весового коэффициента, наблюдаются минимумы, что свидетельствует о том что разные показатели помогают друг другу найти верное решение. Также следует ответить, что ввиду особенности решения обратной задачи ни одно из решений не воспроизвело исходное поле проницаемости, но прогнозные характеристики этих моделей являются удовлетворительными, как с точки зрения пластового давления так и с точки зрения расхода воды.


\section{FUNDING}
The research was carried out within the state assignment of Ministry of Science and Higher Education of the Russian Federation (project No. 121030500156-6).

%
% The Bibliography
%
\begin{thebibliography}{99}
\bibitem{mus} E.N.Musakaev, S.P.Rodionov, D.Y.Legostaev, V.P.Kosyakov,  «Parameter identification for sector filtration model of an oil reservoir with complex structure» // AIP Conference Proceedings 2125,030113 2019;

\bibitem{kos} V.P.Kosyakov, D.Y.Legostaev,  «Computational technology for solution of the reverse problem of filtration theory for oil fields with an aquifer» // AIP Conference Proceedings 2125,030112 2019;

\bibitem{bas} К.С.Басниев, Н.М.Дмитриев, Р.Д.Каневская, В.М.Максимов. Подземная гидромеханика.  М.-Ижевск: Институт компьютерных исследований, 2006. 

\bibitem{dake} L.P.Dake, Fundamentals of Reservoir Engineering (Elsevier, Amsterdam, 1978).

\bibitem{fet} M.J.Fetkovich. A Simplifi ed approach to water infl ux calculations – Finite aquifer systems. J. Pet. Tech. July 1971, vol. 23, is. 7, pp. 814–828.

\bibitem{opt} V.P.Kosyakov, S.P.Rodionov "Optimal control of wells on the basis of two-phase filtration equations". Proceedings of MIPT. 2016. V. 8, N 3. P. 79–90.


\end{thebibliography}

\end{document}